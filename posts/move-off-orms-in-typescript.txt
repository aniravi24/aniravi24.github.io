1:"$Sreact.fragment"
3:I[6221,[],""]
4:I[5657,[],""]
5:I[9712,["678","static/chunks/678-59452238e2c30cf0.js","444","static/chunks/app/posts/move-off-orms-in-typescript/page-043505ff79178ede.js"],"Link"]
6:I[121,["678","static/chunks/678-59452238e2c30cf0.js","444","static/chunks/app/posts/move-off-orms-in-typescript/page-043505ff79178ede.js"],"GoBack"]
7:I[4637,["678","static/chunks/678-59452238e2c30cf0.js","444","static/chunks/app/posts/move-off-orms-in-typescript/page-043505ff79178ede.js"],"ToggleWordWrapButton"]
8:I[8887,["678","static/chunks/678-59452238e2c30cf0.js","444","static/chunks/app/posts/move-off-orms-in-typescript/page-043505ff79178ede.js"],"CopyToClipboard"]
9:I[8002,[],"OutletBoundary"]
b:I[8002,[],"MetadataBoundary"]
d:I[8002,[],"ViewportBoundary"]
f:I[4404,[],""]
:HL["/_next/static/css/3bca1ce63f27b434.css","style"]
0:{"P":null,"b":"BAl_E32EgpTafvRNbxNC9","p":"","c":["","posts","move-off-orms-in-typescript"],"i":false,"f":[[["",{"children":["posts",{"children":["move-off-orms-in-typescript",{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3bca1ce63f27b434.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],"$L2"]}],{"children":["posts",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["move-off-orms-in-typescript",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children","move-off-orms-in-typescript","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[[["$","h1",null,{"children":"Migrating away from query builders and ORMs in JavaScript and TypeScript"}],["$","div",null,{"className":"x:mb-8 x:flex x:gap-3 x:items-center","children":[["$","div",null,{"className":"x:grow x:dark:text-gray-400 x:text-gray-600","children":[["$","div",null,{"className":"x:flex x:flex-wrap x:items-center x:gap-1","children":["Ani Ravi",",",["$","time",null,{"dateTime":"2020-06-12T00:00:00.000Z","children":"6/12/2020"}],["$","span",null,{"className":"x:px-1","children":"‚Ä¢"}],[["$","$L5","ORMs",{"href":"/tags/ORMs","className":"nextra-tag","children":"ORMs"}],["$","$L5","JavaScript",{"href":"/tags/JavaScript","className":"nextra-tag","children":"JavaScript"}],["$","$L5","TypeScript",{"href":"/tags/TypeScript","className":"nextra-tag","children":"TypeScript"}]]]}],"$undefined"]}],["$","$L6",null,{}]]}],[["$","p",null,{"children":["$","em",null,{"children":["Update Apr 2023: It‚Äôs been years since I wrote this and my views have changed quite a bit. While I think there are certainly trade-offs with any solution, the tools in TypeScript have gotten significantly better since I wrote this. As a codebase scales and you work with a team, writing raw queries is not particularly enjoyable. It‚Äôs nicer to have the shorter syntax that ORMs offer, not to mention the built-in type-checking. For example, ",["$","a",null,{"href":"https://prisma.io","target":"_blank","rel":"noreferrer","children":["Prisma",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," and ",["$","a",null,{"href":"https://kysely.dev","target":"_blank","rel":"noreferrer","children":["Kysely",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," are two cool projects at the time of this update."]}]}],"\n",["$","p",null,{"children":"I spent the better part of a day moving a project completely off of the ORM we were using (TypeORM). Ever since I started doing web development, I‚Äôve been using some kind of heavy abstraction on top of my database. Whether it‚Äôs Mongoose when I used MongoDB, or TypeORM when I decided to move to TypeScript and PostgreSQL. However, it turns out that ORMs and query builders aren‚Äôt so great. I used to be that person that thought ORMs and query builders did the job for me, and I used it as an excuse to not learn SQL (which is what everyone tells you NOT to do). Given the tools that exist today, I would wholeheartedly recommend doing it the opposite of how I did if you‚Äôre starting off new to these things‚Ää‚Äî‚Ääwrite your SQL stuff by hand, or with help from the tools I mention later in the post. It‚Äôll feel really slow at first, but you‚Äôll thank yourself later üòÑ"}],"\n",["$","p",null,{"children":"I‚Äôm going to split this post up into three different parts: First, I‚Äôll talk about why query builders and ORMs aren‚Äôt worth using. Second, I‚Äôll explore specific issues I‚Äôve had using ORMs like TypeORM‚Ää‚Äî‚Ääbugs that don‚Äôt actually exist when you directly interface with the DB using the popular driver library in your language or some helper functions. Third, I‚Äôll walk through my current preferred tooling to create an ergonomic experience with the database from a Node.js project‚Ää‚Äî‚Ääwe can replace everything the ORM used to do but better (migrations, typed database schemas and interactions, nice helper functions for simple queries, etc)."}],"\n",["$","h3",null,{"id":"part-1-why-query-builders-and-orms-arent-worthusing","className":"","children":["Part 1: Why query builders and ORMs aren‚Äôt worth¬†using",["$","a",null,{"href":"#part-1-why-query-builders-and-orms-arent-worthusing","className":"not-prose subheading-anchor","aria-label":"Permalink for this section"}]]}],"\n",["$","p",null,{"children":["Query builders (e.g. ",["$","a",null,{"href":"http://knexjs.org/","target":"_blank","rel":"noreferrer","children":["Knex.js",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}],") in general are an unnecessary abstraction on top of the database‚Ää‚Äî‚Ääjust write the SQL. Instead, you‚Äôre busy learning something on top of SQL chaining a bunch of functions together and trying to figure out how a specific tool works instead of how SQL works. You‚Äôre better off learning how SQL works instead of learning a specific query builder‚Äôs toolset. That knowledge is transferrable. SQL itself is also incredibly powerful, used everywhere, and likely won‚Äôt go away anytime soon. Even if you learn new backends or frontends, you‚Äôll still be using SQL. A lot of these benefits are lost when you only work with query builders and ORMs. Also, it can start to get frustrating sometimes when you realize that you know how to do something in SQL, that you don‚Äôt know how to do with an ORM. You‚Äôll try to do things the ‚ÄúORM‚Äù way, to use the tooling provided."]}],"\n",["$","p",null,{"children":["Query builders and ORMs can offer things like sanitization, some type safety, and abstracting away dealing with conflicts with your primary indexes (sometimes), but these can be better handled with the tools I mention in part 3. Also, parameterized queries in ",["$","a",null,{"href":"https://github.com/brianc/node-postgres","target":"_blank","rel":"noreferrer","children":["node-postgres",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," automatically sanitize your inputs‚Ää‚Äî‚Ääso the query builder doesn‚Äôt need to do that for you."]}],"\n",["$","p",null,{"children":["$","em",null,{"children":"Edit Dec 2020: Another thing ORMs/query builders are good for is being able to compose your queries‚Ää‚Äî‚Äädynamic queries are easier to do since they are typically chained function calls."}]}],"\n",["$","h3",null,{"id":"part-2-unnecessary-problems-and-frustrations-ive-dealt-with-using-orms-liketypeorm","className":"","children":["Part 2: Unnecessary problems and frustrations I‚Äôve dealt with using ORMs like¬†TypeORM",["$","a",null,{"href":"#part-2-unnecessary-problems-and-frustrations-ive-dealt-with-using-orms-liketypeorm","className":"not-prose subheading-anchor","aria-label":"Permalink for this section"}]]}],"\n",["$","p",null,{"children":["I‚Äôd often have to spend time debugging issues with the ORM, that the underlying Node.js PostgreSQL driver (the wonderful ",["$","a",null,{"href":"https://github.com/brianc/node-postgres","target":"_blank","rel":"noreferrer","children":["node-postgres",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}],", which I‚Äôll be calling ‚Äúpg‚Äù from now on) didn‚Äôt actually have any issues with. Let me walk through a non-exhaustive list of problems I‚Äôve had working with TypeORM. I‚Äôm picking on ORMs in general here, so this isn‚Äôt a bag on TypeORM."]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":["Trying to use it with one-off scripts, ",["$","a",null,{"href":"https://www.npmjs.com/package/ts-node","target":"_blank","rel":"noreferrer","children":["ts-node",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," or ",["$","a",null,{"href":"https://www.npmjs.com/package/ts-node-dev","target":"_blank","rel":"noreferrer","children":["ts-node-dev",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]]}]}],"\n",["$","p",null,{"children":["I‚Äôve had strange issues trying to use TypeORM with these tools‚Ää‚Äî‚Ääit‚Äôs been somewhat unpredictable. I know that for some of the scripts, I couldn‚Äôt get the files to run with ts-node, and required compiling it to JS. As soon as I removed TypeORM and used pg, it worked as expected. Handling database connections directly with ",["$","a",null,{"href":"https://node-postgres.com/api/pool/","target":"_blank","rel":"noreferrer","children":["pg.Pool",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," and tools I mention in part 3 make this easy."]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Working through the ORM, instead of utilizing the database¬†directly"}]}],"\n",["$","p",null,{"children":"The problem with tools like TypeORM is your entire database is managed through the ORM. It turns out that ORMs are actually not that powerful, at least not as powerful as SQL itself is. Managing your models in TypeORM leads to a lot of limitations. For example, something I often do in my database models is keep track of when a row was last updated. Doing this in TypeORM means that you do it at the JS layer, where TypeORM will get the current JS date and insert it. The problem with this is that it‚Äôs not happening at the source of truth‚Ää‚Äî‚Ääyour database. If you try to do a query with TypeORM that doesn‚Äôt use one of its higher-level abstractions, you now have data inconsistency. You just changed some data but that column didn‚Äôt update. Instead, if you‚Äôre using Postgres, one option is to use Postgres‚Äôs triggers, so that if a row is modified at all, Postgres will do that work to figure out the rest."}],"\n",["$","p",null,{"children":"Another major limitation is not being able to define models outside of code written in TypeScript. We had several tables in our database that I wrote into SQL but TypeORM had no awareness of (we stopped using TypeORM for migrations first, before removing the rest of it). I could‚Äôve made model files for all of those tables so that TypeORM would be aware of them, but it wasn‚Äôt worth it. On top of this, TypeORM allows you to make junction tables when you define a many-to-many relationship for some of your information, but these can‚Äôt be queried directly without using the query builder or dropping down to plain SQL (losing all type safety)."}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Bulky, inefficient queries"}]}],"\n",["$","p",null,{"children":"If you use TypeORM, go try something right now. Open your ormconfig.js (or¬†.ts,¬†.json, whichever one you use) and go add ‚Äúlogging‚Äù: true. Watch the queries. You might be amazed by 1. how long they are 2. how many there are 3. how inefficient and ugly they are sometimes. For example, a query as simple as"}],"\n",["$","div",null,{"data-pagefind-ignore":"all","className":"nextra-code x:relative x:not-first:mt-6","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L7",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],["$","$L8",null,{"className":""}]]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"SELECT"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" COUNT"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"(‚ÄúuserId‚Äù)"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"FROM"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" users_followers"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"where"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚ÄúuserId‚Äù"}],["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"="}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"‚Äôblah"}],["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"-"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"uuid"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"'"}]]}]]}]]}]]}],"\n",["$","p",null,{"children":"is actually this in TypeORM"}],"\n",["$","div",null,{"data-pagefind-ignore":"all","className":"nextra-code x:relative x:not-first:mt-6","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L7",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],["$","$L8",null,{"className":""}]]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"SELECT"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚ÄúUsers_followers_rc‚Äù.‚ÄùuserId‚Äù "}],["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"AS"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚ÄúparentId‚Äù, "}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"COUNT"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"(‚Äúusers‚Äù.‚Äùid‚Äù) "}],["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"AS"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚Äúcnt‚Äù"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"FROM"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚Äúusers‚Äù ‚Äúusers‚Äù"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"INNER JOIN"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚Äúusers_followers‚Äù ‚ÄúUsers_followers_rc‚Äù"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"ON"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚ÄúUsers_followers_rc‚Äù.‚ÄùuserId‚Äù"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"IN"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" (‚Äòblah"}],["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"-"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"uuid‚Äô)"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"AND"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚ÄúUsers_followers_rc‚Äù.‚ÄùfollowerId‚Äù "}],["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"="}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚Äúusers‚Äù.‚Äùid‚Äù"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"GROUP BY"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" ‚ÄúUsers_followers_rc‚Äù.‚ÄùuserId‚Äù"}]]}]]}]]}]]}],"\n",["$","p",null,{"children":"We‚Äôre often told that the ORM ‚Äútakes care of the DB so you don‚Äôt have to do think about it‚Äù, but as I‚Äôve done more development, I‚Äôve learned that this is not the right approach. Your database is often the source of truth‚Ää‚Äî‚Ääand is also probably one of the slowest things in your entire stack, as it deals with stuff that‚Äôs persistent on disk, not memory like the rest of your stack probably does most of the time. Also, go check out what actually happens when you use save() in TypeORM. It makes sense when you think about it, but it‚Äôs probably more queries than you thought."}],"\n",["$","p",null,{"children":"ORMs also often try to support many different SQL dialects or different environments. You may find that there are specific features of a DB, say, Postgres, that you want to use. Those constructs to write better queries might not be available to you if you use an ORM. You could argue that you should aim for portability, not to be tied to a DB‚Ää‚Äî‚Ääbut we‚Äôll cross that bridge if it ever matters."}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Migrations? Meh.."}]}],"\n",["$","p",null,{"children":["Another huge problem with ORMs is that the migrations they generate aren‚Äôt the best. For example, TypeORM will generate indices of any kind with some random string of characters. I still haven‚Äôt figured out why this is necessary unless a different dialect of SQL justifies it (I only use Postgres). So you might see a query like CREATE INDEX IDX_2123asf67s6a3agab31a instead of the default convention that Postgres uses‚Ää‚Äî‚Ääwhich is easy to understand, and easy to work with. You can probably guess what it‚Äôs called without even looking at your database because the ",["$","a",null,{"href":"https://gist.github.com/popravich/d6816ef1653329fb1745","target":"_blank","rel":"noreferrer","children":["convention",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," Postgres already uses is pretty straightforward."]}],"\n",["$","p",null,{"children":"Sometimes the migrations you‚Äôll get are straight-up wrong, but that‚Äôs the nature of trying to automate stuff like this. Other times, it‚Äôll add extra indices where it doesn‚Äôt need to, or you‚Äôll stare at your migration and realize that the default stuff it uses or even the quality of the query is not that great. Your migrations will look a lot cleaner written by hand. When you let your ORM handle migrations for you, it can‚Äôt be smart enough often to deal with things like altering columns. TypeORM will often drop your column and make a new one‚Ää‚Äî‚Ääthat‚Äôs not a real solution in a lot of cases, unfortunately. If you write your migration by hand, these are easily solvable problems."}],"\n",["$","p",null,{"children":"Your migrations may also run more slowly if you need TypeScript to be compiled first. If you need to write any migrations by hand, you may notice that when you need to auto-generate migrations again, it might change or mess with the stuff you already modified (as expected, but that‚Äôs not what you would like in the ideal world). Also, does anyone actually do down migrations? More on this below in my preferred tools for doing migrations."}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"The defaults are not that¬†good"}]}],"\n",["$","p",null,{"children":"I noticed some of the default types TypeORM recommends from the JS layer are not likely what you want in Postgres. Don‚Äôt get me wrong‚Ää‚Äî‚Ääthis is remedied by passing in parameters in the model decorators, but if you‚Äôre relying on TypeORM to take care of it for you, these are things you won‚Äôt know about. For example, by default, TypeORM will generate a timestamp without a time zone if you use a date column. It basically makes no sense to ever do this. Use timestamptz. Also, character varying without a parameter is the same as the TEXT type in Postgres (specifically in Postgres, YMMV with other SQL dialects). Fewer characters to type for you, same underlying representation."}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Doesn‚Äôt feel like working with SQL (by¬†design?)"}]}],"\n",["$","p",null,{"children":"ORMs are designed to make you feel like the database is abstracted to work with your language of choice. Instead of feeling like you‚Äôre working with something where people actually understand SQL and databases and are trying to make that easier for you. It often doesn‚Äôt feel like that."}],"\n",["$","p",null,{"children":"SQL is such a declarative language and reads like English that it‚Äôs often nicer to use it directly."}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"No type safety once you drop away from the high-level abstractions"}]}],"\n",["$","p",null,{"children":"One general problem with ORMs is that the type safety only exists as long as you‚Äôre working through their abstractions. Once you need to drop to SQL, you lose type safety entirely. How could we make this at least somewhat better? More on this in part 3."}],"\n",["$","p",null,{"children":"If I had to design an ORM from scratch, it would probably have a lot of these same problems. It‚Äôs probably better to not work with this abstraction in the first place if possible with your tooling of choice."}],"\n",["$","h3",null,{"id":"part-3-my-preferred-setup-getting-all-the-goodies-without-the-badstuff","className":"","children":["Part 3: My preferred setup, getting all the goodies without the bad¬†stuff",["$","a",null,{"href":"#part-3-my-preferred-setup-getting-all-the-goodies-without-the-badstuff","className":"not-prose subheading-anchor","aria-label":"Permalink for this section"}]]}],"\n",["$","p",null,{"children":"Now that you‚Äôve read my mini-rant, let me share what my preferred tooling is today for completely moving off ORMs and query builders, as well as what the benefits are! Can we really have our cake and eat it too?"}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Replacing migrations"}]}],"\n",["$","p",null,{"children":["Let‚Äôs start with migrations first! This one is easy. I use ",["$","a",null,{"href":"https://github.com/graphile/migrate","target":"_blank","rel":"noreferrer","children":["https://github.com/graphile/migrate",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," (thanks ",["$","a",null,{"href":"https://medium.com/u/486409fe9425","target":"_blank","rel":"noreferrer","children":["John Haley",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," for the recommendation!)"]}],"\n",["$","p",null,{"children":"It‚Äôs super straightforward to use‚Ää‚Äî‚Ääyou write your SQL files, and run a command. You can even run a watch command that will watch your file and execute the migrations as you work on it (I‚Äôve never used this, personally). It‚Äôs also super fast‚Ää‚Äî‚Ääbecause it‚Äôs plain SQL. No JavaScript to deal with anywhere. The tool itself is built in TypeScript and uses pg under the hood. It‚Äôs fast."}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Replacing the rest of the¬†ORM"}]}],"\n",["$","p",null,{"children":["A big inspiration for me writing this piece was a ",["$","a",null,{"href":"https://github.com/jawj/mostly-ormless","target":"_blank","rel":"noreferrer","children":["project",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," I came across on GitHub a while ago. I initially didn‚Äôt want to go through it to implement it myself, but the wonderful author has made it an actual library. The package is called ",["$","a",null,{"href":"https://jawj.github.io/zapatos/","target":"_blank","rel":"noreferrer","children":["Zapatos",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}],". With this, you can automatically generate TypeScript types from your database (originally inspired from a package called ",["$","a",null,{"href":"https://github.com/sweetiq/schemats#readme","target":"_blank","rel":"noreferrer","children":["Schemats",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," which is now unmaintained), do somewhat type-checked SQL queries, and get nifty helpers along the way, up to the level of abstraction you‚Äôd like without going overboard. Remember how I was talking about needing to keep the DB in sync with the backend? I don‚Äôt need to do that anymore. Honestly, some of the helpers here are better than what ORMs I‚Äôve seen offer‚Ää‚Äî‚Ääat least for the queries that I‚Äôd use the ORM for. I would highly recommend reading the documentation (it‚Äôs straightforward to understand) and taking a look at it yourself‚Ää‚Äî‚ÄäI won‚Äôt do it justice."]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"I see the questions already‚Ä¶ But Ani, isn‚Äôt this just like another ORM?"}],"\n"]}],"\n",["$","p",null,{"children":"If you use it, you‚Äôll see that it‚Äôs not. It ultimately uses pg and has some nifty helpers to help you do better type-checking, and make certain queries easier. It does not try to write strangely complex queries, manage connection pooling, or do anything super fancy (although generating the types from your database for you is amazing and fancy in and of itself). It‚Äôll convert whatever you pass it to pretty much the exact query you would write if you wrote it by hand (most of the time, with the exception of the highest abstractions near the bottom of the docs). It stays pretty lean in terms of what it offers and what it can do for you‚Ää‚Äî‚Äämost of it is ultimately on you to write a proper query. The files it generates are put directly into your project‚Äôs source code, so you can see exactly what it does."}],"\n",["$","h3",null,{"id":"bonus-part-4-abstracting-the-apiitself","className":"","children":["Bonus, Part 4: Abstracting the API¬†itself",["$","a",null,{"href":"#bonus-part-4-abstracting-the-apiitself","className":"not-prose subheading-anchor","aria-label":"Permalink for this section"}]]}],"\n",["$","p",null,{"children":["Gotten this far? I thought I‚Äôd give a shoutout to some of the tools that have come in recent years to help build backends faster. Tools like ",["$","a",null,{"href":"https://www.graphile.org/postgraphile/","target":"_blank","rel":"noreferrer","children":["PostGraphile",["‚Äâ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]],"className":"x:focus-visible:nextra-focus"}]," generate a performant GraphQL API on top of your database. They invert the model and turn your development model into database driven design. It‚Äôll teach you a lot about how to use your database‚Äôs powerful features instead of using it like a dummy data store you abstract away through code."]}],"\n",["$","p",null,{"children":"Thanks for reading! Please let me know if you have any feedback in the comments below. I haven‚Äôt been writing that much about programming-related topics so I thought I‚Äôd kick it off with a light intro to something I did recently."}]]],null,["$","$L9",null,{"children":"$La"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","6JjSDFwrIHTKomgRTFHy4",{"children":[["$","$Lb",null,{"children":"$Lc"}],["$","$Ld",null,{"children":"$Le"}],null]}]]}],false]],"m":"$undefined","G":["$f","$undefined"],"s":false,"S":true}
10:I[3543,["678","static/chunks/678-59452238e2c30cf0.js","530","static/chunks/app/posts/page-b778f93988eba942.js"],"ThemeProvider"]
11:I[9712,["678","static/chunks/678-59452238e2c30cf0.js","444","static/chunks/app/posts/move-off-orms-in-typescript/page-043505ff79178ede.js"],"ViewTransitions"]
12:I[6521,["678","static/chunks/678-59452238e2c30cf0.js","530","static/chunks/app/posts/page-b778f93988eba942.js"],"NavbarLink"]
13:I[3381,["678","static/chunks/678-59452238e2c30cf0.js","530","static/chunks/app/posts/page-b778f93988eba942.js"],"ThemeSwitch"]
14:I[3007,["448","static/chunks/3621f9d8-2a1db3a89b45430e.js","678","static/chunks/678-59452238e2c30cf0.js","554","static/chunks/554-510b3188b2a3af9c.js","177","static/chunks/app/layout-4e9183cb2ce6f840.js"],"Search"]
2:["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","link",null,{"rel":"alternate","type":"application/rss+xml","title":"RSS","href":"/feed.xml"}],["$","style",null,{"children":":root {\n  --nextra-primary-hue: 212deg;\n  --nextra-primary-saturation: 100%;\n  --nextra-primary-lightness: 45%;\n  --nextra-bg: 250,250,250;\n  --nextra-content-width: 90rem;\n}\n.dark {\n  --nextra-primary-hue: 204deg;\n  --nextra-primary-saturation: 100%;\n  --nextra-primary-lightness: 55%;\n  --nextra-bg: 17,17,17;\n}\n::selection {\n  background: hsla(var(--nextra-primary-hue),var(--nextra-primary-saturation),var(--nextra-primary-lightness),.3);\n}\nhtml {\n  background: rgb(var(--nextra-bg));\n}"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: light)","content":"rgb(250,250,250)"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: dark)","content":"rgb(17,17,17)"}],"$undefined"]}],["$","body",null,{"children":["$","$L10",null,{"attribute":"class","children":["$undefined",["$","article",null,{"className":"x:container x:px-4 x:prose x:max-md:prose-sm x:dark:prose-invert","dir":"ltr","data-pagefind-body":true,"children":["$","$L11",null,{"children":[["$","header",null,{"className":"x:mb-8 x:flex x:items-center x:gap-3 x:justify-end","data-pagefind-ignore":"all","children":[[["$","$L12","/",{"href":"/","children":"Home"}],["$","$L12","/posts",{"href":"/posts","children":"Posts"}]],[[["$","a","rss",{"href":"/feed.xml","children":"RSS"}],["$","a","github",{"href":"https://github.com/aniravi24","children":"Github"}]],["$","$L13",null,{}],["$","$L14",null,{"placeholder":"Search..."}]]]}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}],["$","small",null,{"className":"x:mt-32 x:block","data-pagefind-ignore":"all","children":["$","div",null,{"className":"my-4 border-t-2 mx-auto flex items-center sm:flex-row flex-col","children":["$","p",null,{"className":"text-sm text-gray-500","children":"Ani Ravi"}]}]}]]}]}]]}]}]]}]
e:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"name":"theme-color","content":"#ffffff"}]]
c:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Migrating away from query builders and ORMs in JavaScript and TypeScript"}],["$","meta","2",{"name":"description","content":"Alternatives"}],["$","link","3",{"rel":"manifest","href":"/manifest.json","crossOrigin":"$undefined"}],["$","meta","4",{"name":"robots","content":"index, follow"}],["$","meta","5",{"name":"msapplication-TileColor","content":"#da532c"}],["$","link","6",{"rel":"icon","href":"/favicon-16.png","sizes":"16x16","type":"image/png"}],["$","link","7",{"rel":"icon","href":"/favicon-32.png","sizes":"32x32","type":"image/png"}],["$","link","8",{"rel":"icon","href":"/favicon-48.png","sizes":"48x48","type":"image/png"}],["$","link","9",{"rel":"apple-touch-icon","href":"/apple-touch-icon.png","sizes":"180x180","type":"image/png"}]]
a:null
